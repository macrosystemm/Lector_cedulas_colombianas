<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Prueba Cámara</title>
  <style>
    video { width: 90%; max-width: 500px; border: 2px solid #000; }
  </style>
</head>
<body>
<h2>Prueba de Cámara</h2>
<video id="video" autoplay playsinline></video>

<script src="https://cdn.jsdelivr.net/npm/@zxing/library@0.19.1/umd/index.min.js"></script>
<script>
(async () => {
  const video = document.getElementById('video');

  try {
    // 1️⃣ Abrir cámara primero
    const stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: 'environment', width: { ideal: 1280 }, height: { ideal: 720 } }
    });
    video.srcObject = stream;
    await video.play();

    // 2️⃣ Pasar el video a ZXing
    const codeReader = new ZXing.BrowserBarcodeReader(undefined, {
      decodeHints: { POSSIBLE_FORMATS: [ZXing.BarcodeFormat.PDF_417] }
    });

    codeReader.decodeFromVideoElement(video, (result, err) => {
      if (err && !(err instanceof ZXing.NotFoundException)) console.warn(err);
      if (result) console.log("Código leído:", result.getText());
    });

  } catch (e) {
    alert("No se pudo abrir la cámara: " + e.message);
    console.error(e);
  }
})();
</script>
</body>
</html>
